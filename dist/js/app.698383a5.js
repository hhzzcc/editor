(function(){"use strict";var e={221:function(e,t,n){var o=n(9242),a=n(3396);function l(e,t){const n=(0,a.up)("router-view");return(0,a.wg)(),(0,a.j4)(n)}var s=n(89);const i={},r=(0,s.Z)(i,[["render",l]]);var u=r,d=n(2483);const h={class:"home-view"},c={class:"home-view__header"},m=(0,a._)("img",{class:"home-view__logo",src:"https://st0.dancf.com/static/02/202301130825-f513.png"},null,-1),g={class:"home-view__body"},f={class:"home-view__left"},p={class:"home-view__content"},y={class:"home-view__editor",ref:"parent"},w={class:"home-view__right"};function v(e,t,n,o,l,s){const i=(0,a.up)("SceneBar"),r=(0,a.up)("ImageBar"),u=(0,a.up)("TextBar"),d=(0,a.up)("GroupBar");return(0,a.wg)(),(0,a.iD)("div",h,[(0,a._)("div",c,[m,(0,a._)("button",{onClick:t[0]||(t[0]=(...e)=>o.handleDownload&&o.handleDownload(...e))},"下载")]),(0,a._)("div",g,[(0,a._)("div",f,[(0,a._)("button",{onClick:t[1]||(t[1]=e=>o.handleAddElement("image"))},"添加图片"),(0,a._)("button",{onClick:t[2]||(t[2]=e=>o.handleAddElement("text"))},"添加文字")]),(0,a._)("div",p,[(0,a._)("div",y,null,512)]),(0,a._)("div",w,[o.editElement?"image"===o.editElement.elementType?((0,a.wg)(),(0,a.j4)(r,{key:1,x:o.editElement.state.x,y:o.editElement.state.y,width:o.editElement.state.width,height:o.editElement.state.height,angle:o.editElement.state.angle,onChangeX:t[3]||(t[3]=e=>o.editElement.setX(e)),onChangeY:t[4]||(t[4]=e=>o.editElement.setY(e)),onChangeWidth:t[5]||(t[5]=e=>o.editElement.setWidth(e)),onChangeHeight:t[6]||(t[6]=e=>o.editElement.setHeight(e)),onChangeAngle:t[7]||(t[7]=e=>o.editElement.setAngle(e))},null,8,["x","y","width","height","angle"])):"text"===o.editElement.elementType?((0,a.wg)(),(0,a.j4)(u,{key:2,x:o.editElement.state.x,y:o.editElement.state.y,angle:o.editElement.state.angle,text:o.editElement.state.text,fontSize:o.editElement.state.fontSize,fontColor:o.editElement.state.fontColor,fontFamily:o.editElement.state.fontFamily,onChangeX:t[8]||(t[8]=e=>o.editElement.setX(e)),onChangeY:t[9]||(t[9]=e=>o.editElement.setY(e)),onChangeAngle:t[10]||(t[10]=e=>o.editElement.setAngle(e)),onChangeText:t[11]||(t[11]=e=>o.editElement.setText(e)),onChangeFontSize:t[12]||(t[12]=e=>o.editElement.setFontSize(e)),onChangeFontFamily:t[13]||(t[13]=e=>o.editElement.setFontFamily(e)),onChangeFontColor:t[14]||(t[14]=e=>o.editElement.setFontColor(e))},null,8,["x","y","angle","text","fontSize","fontColor","fontFamily"])):"group"===o.editElement.elementType?((0,a.wg)(),(0,a.j4)(d,{key:3,x:o.editElement.state.x,y:o.editElement.state.y,angle:o.editElement.state.angle,temporary:o.editElement.state.temporary,onChangeX:t[15]||(t[15]=e=>o.editElement.setX(e)),onChangeY:t[16]||(t[16]=e=>o.editElement.setY(e)),onChangeAngle:t[17]||(t[17]=e=>o.editElement.setAngle(e)),onChangePermanent:t[18]||(t[18]=()=>o.editElement.permanent()),onChangeTemporary:t[19]||(t[19]=()=>o.editElement.temporary())},null,8,["x","y","angle","temporary"])):(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(i,{key:0,width:400,height:600}))])])])}const x={class:"image-bar"},b=(0,a._)("div",null,"图片",-1);function C(e,t,n,o,l,s){const i=(0,a.up)("Input");return(0,a.wg)(),(0,a.iD)("div",x,[b,(0,a.Wm)(i,{value:e.x,onChange:t[0]||(t[0]=t=>e.$emit("change-x",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.y,onChange:t[1]||(t[1]=t=>e.$emit("change-y",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("Y")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.width,onChange:t[2]||(t[2]=t=>e.$emit("change-width",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("宽")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.height,onChange:t[3]||(t[3]=t=>e.$emit("change-height",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("高")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.angle,onChange:t[4]||(t[4]=t=>e.$emit("change-angle",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("旋转角度")])),_:1},8,["value"])])}var M=n(3271),S=(0,a.aZ)({name:"image-bar",components:{Input:M.ZP},props:{x:{type:[String,Number],default:0},y:{type:[String,Number],default:0},width:{type:[String,Number],default:0},height:{type:[String,Number],default:0},angle:{type:[String,Number],default:0}}});const E=(0,s.Z)(S,[["render",C]]);var X=E;const k={class:"text-bar"},Y=(0,a._)("div",null,"文字",-1);function _(e,t,n,o,l,s){const i=(0,a.up)("Input"),r=(0,a.up)("SelectOption"),u=(0,a.up)("Select");return(0,a.wg)(),(0,a.iD)("div",k,[Y,(0,a._)("div",null,[(0,a.Wm)(i,{value:e.x,onChange:t[0]||(t[0]=t=>e.$emit("change-x",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.y,onChange:t[1]||(t[1]=t=>e.$emit("change-y",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("Y")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.angle,onChange:t[2]||(t[2]=t=>e.$emit("change-angle",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("旋转角度")])),_:1},8,["value"])]),(0,a.Wm)(i,{value:e.text,onChange:t[3]||(t[3]=t=>e.$emit("change-text",t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("内容")])),_:1},8,["value"]),(0,a.Wm)(u,{value:e.fontFamily,onChange:t[4]||(t[4]=t=>e.$emit("change-font-family",t))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("X")])),default:(0,a.w5)((()=>[(0,a.Wm)(r,{value:"serif"},{default:(0,a.w5)((()=>[(0,a.Uk)("serif")])),_:1}),(0,a.Wm)(r,{value:"fangsong"},{default:(0,a.w5)((()=>[(0,a.Uk)("仿宋")])),_:1})])),_:1},8,["value"]),(0,a.Wm)(u,{value:e.fontSize,onChange:t[5]||(t[5]=t=>e.$emit("change-font-size",t))},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{value:14},{default:(0,a.w5)((()=>[(0,a.Uk)("14px")])),_:1}),(0,a.Wm)(r,{value:20},{default:(0,a.w5)((()=>[(0,a.Uk)("20px")])),_:1})])),_:1},8,["value"]),(0,a.Wm)(i,{type:"color",value:e.fontColor,onChange:t[6]||(t[6]=t=>e.$emit("change-font-color",t.target.value))},null,8,["value"])])}var B=n(4640),$=(0,a.aZ)({name:"text-bar",components:{Select:B.ZP,SelectOption:B.$m,Input:M.ZP},props:{x:{type:[String,Number],default:0},y:{type:[String,Number],default:0},width:{type:[String,Number],default:0},height:{type:[String,Number],default:0},angle:{type:[String,Number],default:0},text:{type:String,default:""},fontFamily:{type:String,default:""},fontSize:{type:[String,Number],default:0},fontColor:{type:String,default:""}}});const T=(0,s.Z)($,[["render",_]]);var W=T;const F={class:"image-bar"},H=(0,a._)("div",null,"组",-1);function R(e,t,n,o,l,s){const i=(0,a.up)("Input"),r=(0,a.up)("Button");return(0,a.wg)(),(0,a.iD)("div",F,[H,(0,a.Wm)(i,{value:e.x,onChange:t[0]||(t[0]=t=>e.$emit("change-x",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("X")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.y,onChange:t[1]||(t[1]=t=>e.$emit("change-y",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("Y")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.angle,onChange:t[2]||(t[2]=t=>e.$emit("change-angle",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("旋转角度")])),_:1},8,["value"]),e.temporary?((0,a.wg)(),(0,a.j4)(r,{key:0,onClick:t[3]||(t[3]=t=>e.$emit("change-permanent"))},{default:(0,a.w5)((()=>[(0,a.Uk)("成组")])),_:1})):((0,a.wg)(),(0,a.j4)(r,{key:1,onClick:t[4]||(t[4]=t=>e.$emit("change-temporary"))},{default:(0,a.w5)((()=>[(0,a.Uk)("解组")])),_:1}))])}var I=n(2514),z=(0,a.aZ)({name:"group-bar",components:{Input:M.ZP,Button:I.Z},props:{x:{type:[String,Number],default:0},y:{type:[String,Number],default:0},width:{type:[String,Number],default:0},height:{type:[String,Number],default:0},angle:{type:[String,Number],default:0},temporary:{type:Boolean,default:!1}}});const N=(0,s.Z)(z,[["render",R]]);var P=N;const Z={class:"scene-bar"},j=(0,a._)("div",null,"画布尺寸",-1);function D(e,t,n,o,l,s){const i=(0,a.up)("Input");return(0,a.wg)(),(0,a.iD)("div",Z,[j,(0,a.Wm)(i,{value:e.width,onChange:t[0]||(t[0]=t=>e.$emit("change-width",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("宽")])),_:1},8,["value"]),(0,a.Wm)(i,{value:e.height,onChange:t[1]||(t[1]=t=>e.$emit("change-height",+t.target.value))},{addonBefore:(0,a.w5)((()=>[(0,a.Uk)("高")])),_:1},8,["value"])])}var U=(0,a.aZ)({name:"scene-bar",components:{Input:M.ZP},props:{width:{type:[String,Number],default:0},height:{type:[String,Number],default:0}}});const A=(0,s.Z)(U,[["render",D]]);var L=A,O=n(4870);class q{constructor(e={}){const{x:t=0,y:n=0,width:o=100,height:a=100,angle:l=0,hover:s=!1,focus:i=!1,operable:r=!0,zIndex:u=null}=e;this.state={x:t,y:n,width:o,height:a,hover:s,focus:i,operable:r,zIndex:u,angle:l}}getPosition(){return{x:this.state.x,y:this.state.y}}getCenterPosition(){const{x:e,y:t}=this.getPosition();return{x:e+this.state.width/2,y:t+this.state.height/2}}getRightPosition(){const{x:e,y:t}=this.getPosition();return{x:e+this.state.width,y:t+this.state.height}}setPosition(e,t){this.setX(e),this.setY(t)}transform(e,t){this.transformX(e),this.transformY(t)}transformX(e){this.setX(this.state.x+e)}transformY(e){this.setY(this.state.y+e)}setX(e){this.state.x=+e.toFixed(2)}setY(e){this.state.y=+e.toFixed(2)}setAngle(e){this.state.angle=Math.ceil(e)}scale(e,t){this.scaleX(e),this.scaleY(t)}scaleX(e){this.setWidth(this.state.width*e)}scaleY(e){this.setHeight(this.state.height*e)}setWidth(e){return this.state.width=+e.toFixed(2),this.state.width}setHeight(e){return this.state.height=+e.toFixed(2),this.state.height}setZIndex(e){this.state.zIndex=e}hover(){this.state.hover=!0}unHover(){this.state.hover=!1}focus(){this.state.focus=!0}blur(){this.state.focus=!1}operable(){this.state.operable=!0}inoperable(){this.state.operable=!1}}class G extends q{constructor({imgSrc:e,...t}){super(t),this.elementType="image",this.setImgSrc(e)}async setImgSrc(e){this.state.imgSrc=e}}class K extends q{constructor({text:e,fontSize:t=24,fontColor:n="#000000",fontFamily:o="fangsong",...a}){super(a),this.elementType="text",this.target={el:null,contentEl:null,textEl:null},this.setFontSize(t),this.setFontColor(n),this.setFontFamily(o),this.setText(e)}setTarget(e){this.target=e}setFontColor(e){this.state.fontColor=e}setFontFamily(e){this.state.fontFamily=e}setFontSize(e){this.state.fontSize=+e.toFixed(2)}setText(e){this.state.text=e}startEdit(){this.state.edit=!0}endEdit(){this.state.edit=!1}updateWidth(){this.target.textEl&&this.setWidth(this.target.textEl.offsetWidth)}updateHeight(){this.target.textEl&&this.setHeight(this.target.textEl.offsetHeight)}updateSize(){this.updateWidth(),this.updateHeight()}}n(7658);function J(e){return new Promise((t=>{if(e.startsWith("data:"))return void t(e);window.URL=window.URL||window.webkitURL;const n=new XMLHttpRequest;n.open("get",e,!0),n.responseType="blob",n.onload=function(){if(200==this.status){const e=this.response,n=new FileReader;n.onloadend=function(e){t(e.target.result)},n.readAsDataURL(e)}},n.send()}))}async function Q(e){const t=e.offsetWidth,n=e.offsetHeight,o=e.querySelectorAll("img"),a=[];for(let r=0;r<o.length;r++)a.push(new Promise((e=>{const t=o[r];J(t.src).then((n=>{t.src=n,e()}))})));await Promise.all(a);const l=new Image;l.width=t,l.height=n,l.onload=function(){const e=document.createElement("canvas"),o=e.getContext("2d");e.width=t,e.height=n,o.clearRect(0,0,t,n),o.drawImage(this,0,0,t,n);const a="image/png",l=e.toDataURL(a),s=document.createElement("a");s.download="下载.png",s.href=l,s.dataset.downloadurl=[a,s.download,s.href].join(":"),s.click()};let s="";const i=document.querySelectorAll("style");for(let r=0;r<i.length-1;r++){const e=i[r];s+=e.innerHTML}l.src=`data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg"><foreignObject width="${t}" height="${n}"><body xmlns="http://www.w3.org/1999/xhtml">\n            ${(new XMLSerializer).serializeToString(e)}\n            <style>${s}</style></body></foreignObject></svg>`.replace(/\n/g,"").replace(/\t/g,"").replace(/#/g,"%23")}const V=5,ee=10;class te{constructor({width:e,height:t,$parent:n}){const o=document.createElement("canvas");o.width=e,o.height=t,o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.zIndex="9",o.style.pointerEvents="none",n.appendChild(o),this.canvas=o,this.ctx=o.getContext("2d")}drawXLine(e){const{ctx:t,canvas:n}=this;t.beginPath(),t.moveTo(0,e),t.lineTo(n.width,e),t.strokeStyle="#F56C6C",t.lineWidth=1,t.stroke(),t.closePath()}drawYLine(e){const{ctx:t,canvas:n}=this;t.beginPath(),t.moveTo(e,0),t.lineTo(e,n.height),t.strokeStyle="#F56C6C",t.lineWidth=1,t.stroke(),t.closePath()}clear(){const{ctx:e,canvas:t}=this;e.clearRect(0,0,t.width,t.height)}updateAdsorptionX({originX:e,originCenterX:t,originRightX:n,targetX:o,targetCenterX:a,targetRightX:l}){return Math.abs(t-a)<V?{type:"center",value:a}:Math.abs(t-o)<V?{type:"center",value:o}:Math.abs(t-l)<V?{type:"center",value:l}:Math.abs(e-a)<V?{type:"left",value:a}:Math.abs(e-l)<V?{type:"left",value:l}:Math.abs(e-o)<V?{type:"left",value:o}:Math.abs(n-a)<V?{type:"right",value:a}:Math.abs(n-o)<V?{type:"right",value:o}:Math.abs(n-l)<V?{type:"right",value:l}:null}updateAdsorptionY({originY:e,originCenterY:t,originRightY:n,targetY:o,targetCenterY:a,targetRightY:l}){return Math.abs(t-a)<V?{type:"center",value:a}:Math.abs(t-o)<V?{type:"center",value:o}:Math.abs(t-l)<V?{type:"center",value:l}:Math.abs(e-a)<V?{type:"top",value:a}:Math.abs(e-l)<V?{type:"top",value:l}:Math.abs(e-o)<V?{type:"top",value:o}:Math.abs(n-a)<V?{type:"bottom",value:a}:Math.abs(n-o)<V?{type:"bottom",value:o}:Math.abs(n-l)<V?{type:"bottom",value:l}:null}update({originElement:e,targetElements:t}){let n=null,o=null;for(let a=0;a<t.length;a++){const l=t[a];if(l===e)continue;const{x:s,y:i}=e.getPosition(),{x:r,y:u}=e.getCenterPosition(),{x:d,y:h}=e.getRightPosition(),{x:c,y:m}=l.getPosition(),{x:g,y:f}=l.getCenterPosition(),{x:p,y:y}=l.getRightPosition(),w=this.updateAdsorptionX({originX:s,originCenterX:r,originRightX:d,targetX:c,targetCenterX:g,targetRightX:p}),v=this.updateAdsorptionY({originY:i,originCenterY:u,originRightY:h,targetY:m,targetCenterY:f,targetRightY:y});w&&(n=w),v&&(o=v)}return this.clear(),n&&this.drawYLine(n.value),o&&this.drawXLine(o.value),{xType:n?n.type:null,yType:o?o.type:null,x:n?n.value:null,y:o?o.value:null}}}function ne({x1:e,y1:t,width1:n,height1:o,x2:a,y2:l,width2:s,height2:i}){const r=[{x:e,y:t},{x:e+n,y:t},{x:e,y:t+o},{x:e+n,y:t+o}];for(let u=0;u<r.length;u++){const e=r[u];if(e.x>a&&e.x<a+s&&e.y>l&&e.y<l+i)return!0}return!1}class oe{constructor({width:e,height:t,$parent:n}){const o=document.createElement("canvas");o.width=e,o.height=t,o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.zIndex="9",o.style.pointerEvents="none",n.appendChild(o),this.canvas=o,this.ctx=o.getContext("2d")}ready({originX:e,originY:t}){this.originX=e,this.originY=t,this.collectElements=[]}update({x:e,y:t,targetElements:n}){this.clear();const{ctx:o,originX:a,originY:l}=this,s=e-a,i=t-l;let r,u,d,h;s<0?(r=e,d=-s):(r=a,d=s),i<0?(u=t,h=-i):(u=l,h=i),o.strokeStyle="blue",o.lineWidth=1,o.beginPath(),o.strokeRect(r,u,d,h),o.stroke();const c=[];for(let m=0;m<n.length;m++){const e=n[m];ne({x1:e.state.x,y1:e.state.y,width1:e.state.width,height1:e.state.height,x2:r,y2:u,width2:d,height2:h})?(e.inoperable(),e.focus(),c.push(e)):(e.operable(),e.blur())}this.collectElements=c}getCollectElements(){return this.collectElements}clear(){const{ctx:e,canvas:t}=this;e.clearRect(0,0,t.width,t.height)}}function ae({type:e,targetElementX:t,originElementX:n,originElementWidth:o}){switch(e){case"left":return t-n;case"center":return t-n-o/2;case"right":return t-n-o}}function le({type:e,targetElementY:t,originElementY:n,originElementHeight:o}){switch(e){case"top":return t-n;case"center":return t-n-o/2;case"bottom":return t-n-o}}class se{constructor(){this.clear()}clear(){this.offsetX=0,this.offsetY=0}handleDragElementTransform({mouse:e,element:t,onTransform:n}){const{x:o,y:a,xType:l,yType:s}=n(t),i=e.movementX,r=e.movementY,u=e.x-this.offsetX,d=e.y-this.offsetY;if(0!==this.offsetX&&Math.abs(u)>ee)t.transformX(u),this.offsetX=0;else if(l){const n=ae({type:l,targetElementX:o,originElementX:t.state.x,originElementWidth:t.state.width});t.transformX(n),0===this.offsetX&&(this.offsetX=e.x)}else t.transformX(i),this.offsetX=0;if(0!==this.offsetY&&Math.abs(d)>ee)t.transformY(d),this.offsetY=0;else if(s){const n=le({type:s,targetElementY:a,originElementY:t.state.y,originElementHeight:t.state.height});t.transformY(n),0===this.offsetY&&(this.offsetY=e.y)}else t.transformY(r),this.offsetY=0}}function ie(e,t,n){const{x:o}=e.getCenterPosition(),{width:a}=e.state,{x:l}=t,s=void 0===n?t.movementX:n;l<o?(e.setX(l),e.setWidth(a-s)):l>o&&e.setWidth(a+s),"text"===e.elementType&&e.updateHeight()}function re(e,t,n){const{y:o}=e.getCenterPosition(),{height:a}=e.state,{y:l}=t,s=void 0===n?t.movementY:n;l<o?(e.setY(l),e.setHeight(a-s)):l>o&&e.setHeight(a+s)}function ue(e,t,n){const{x:o,y:a}=e.getCenterPosition(),{width:l,height:s}=e.state,{x:i,y:r}=t,u=l/s;if(i<o&&r<a){const t=l-n,o=t/u;e.setWidth(t),e.setHeight(o),e.transformX(l-t),e.transformY(s-o)}else if(i<o&&r>a){const t=l-n,o=t/u;e.setWidth(t),e.setHeight(o),e.transformX(l-t)}else if(i>o&&r<a){const t=l+n,o=t/u;e.setWidth(t),e.setHeight(o),e.transformY(s-o)}else if(i>o&&r>a){const t=l+n,o=t/u;e.setWidth(t),e.setHeight(o)}}function de(e,t,n){const{width:o,height:a,fontSize:l}=e.state,{x:s}=e.getCenterPosition(),{x:i}=t,r=n/l,u=+a/r;if(e.setFontSize(u),e.scaleX(u/l),i<s){const t=o-e.state.width;e.transformX(t)}}function he(e,t){const{movementY:n,movementX:o}=t;if("text"===e.elementType){const{height:o}=e.state;re(e,t,n/1.5),de(e,t,o)}else if("group"===e.elementType){const{width:n,height:a}=e.state;ue(e,t,o);const{width:l,height:s}=e.state;for(let o=0;o<e.state.children.length;o++){const i=e.state.children[o],r=l/n,u=s/a;if("group"===i.elementType)he(i,t),i.setWidth(r*i.state.width),i.setHeight(u*i.state.height),i.setX(r*i.state.x),i.setY(u*i.state.y);else if("text"===i.elementType){const e=i.state.height/i.state.fontSize;i.setWidth(r*i.state.width);const t=i.setHeight(u*i.state.height);i.setX(r*i.state.x),i.setY(u*i.state.y),i.setFontSize(t/e)}else i.setWidth(r*i.state.width),i.setHeight(u*i.state.height),i.setX(r*i.state.x),i.setY(u*i.state.y)}}else ue(e,t,o)}function ce({x:e,y:t}){const n=Math.sqrt(e*e+t*t);return{x:e/n,y:t/n}}function me(e,t){const{x:n,y:o}=e.getCenterPosition(),{x:a,y:l}=t,s={x:0,y:1},i=ce({x:a-n,y:l-o}),r=a<n?1:-1;e.setAngle(r*(180*Math.acos(s.x*i.x+s.y*i.y))/Math.PI)}function ge(e){let t=null,n=null,o=null,a=null;for(let l=0;l<e.length;l++){const s=e[l],{x:i,y:r,width:u,height:d}=s.state;t=null===t?r:Math.min(t,r),n=null===n?i+u:Math.max(n,i+u),o=null===o?r+d:Math.max(o,r+d),a=null===a?i:Math.min(a,i)}return{x:a,y:t,width:n-a,height:o-t}}function fe(){return new Promise((e=>{const t=document.createElement("input");t.type="file",t.click(),t.onchange=()=>{const n=t.files[0],o=new FileReader;o.onload=()=>{const t=new Image;t.src=o.result,t.onload=()=>{e(t)}},o.readAsDataURL(n)}}))}class pe extends q{constructor({children:e,...t}){super(t),this.elementType="group",this.add(e)}add(e){this.state.children||(this.state.children=[]),this.state.children.push(...e)}temporary(){this.state.temporary=!0}permanent(){this.state.temporary=!1}}var ye=n(7139);function we(e,t,n,o,l,s){const i=(0,a.up)("ImageElementComponent"),r=(0,a.up)("TextElementComponent"),u=(0,a.up)("GroupElementComponent");return(0,a.wg)(),(0,a.iD)("div",{class:(0,ye.C_)(e.bem())},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.elements,((t,n)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:n},["image"===t.elementType?((0,a.wg)(),(0,a.j4)(i,(0,a.dG)({key:0},t.state,{onMousedownScaleXy:n=>e.handleMousedownScaleXY(t),onMousedownScaleX:n=>e.handleMousedownScaleX(t),onMousedownScaleY:n=>e.handleMousedownScaleY(t),onMousedownRotate:n=>e.handleMousedownRotate(t),onMousedownContent:n=>e.handleMousedownContent(t),onDbClickContent:n=>e.handleDbClickContent(t),onMouseenterContent:n=>e.handleMouseenterContent(t),onMouseleaveContent:n=>e.handleMouseleaveContent(t),onClickContent:n=>e.handleClickContent(t)}),null,16,["onMousedownScaleXy","onMousedownScaleX","onMousedownScaleY","onMousedownRotate","onMousedownContent","onDbClickContent","onMouseenterContent","onMouseleaveContent","onClickContent"])):"text"===t.elementType?((0,a.wg)(),(0,a.j4)(r,(0,a.dG)({key:1},t.state,{onChangeText:n=>e.handleChangeText(n,t),onMousedownScaleXy:n=>e.handleMousedownScaleXY(t),onMousedownScaleX:n=>e.handleMousedownScaleX(t),onMousedownRotate:n=>e.handleMousedownRotate(t),onMousedownContent:n=>e.handleMousedownContent(t),onMouseenterContent:n=>e.handleMouseenterContent(t),onMouseleaveContent:n=>e.handleMouseleaveContent(t),onClickContent:n=>e.handleClickTextElementContent(t),onMounted:n=>e.handleTextElementMounted(t,n)}),null,16,["onChangeText","onMousedownScaleXy","onMousedownScaleX","onMousedownRotate","onMousedownContent","onMouseenterContent","onMouseleaveContent","onClickContent","onMounted"])):"group"===t.elementType?((0,a.wg)(),(0,a.j4)(u,(0,a.dG)({key:2},t.state,{onMousedownScaleXy:n=>e.handleMousedownScaleXY(t),onMousedownRotate:n=>e.handleMousedownRotate(t),onMousedownContent:n=>e.handleMousedownContent(t),onMouseenterContent:n=>e.handleMouseenterContent(t),onMouseleaveContent:n=>e.handleMouseleaveContent(t),onClickContent:n=>e.handleClickContent(t)}),null,16,["onMousedownScaleXy","onMousedownRotate","onMousedownContent","onMouseenterContent","onMouseleaveContent","onClickContent"])):(0,a.kq)("",!0)],64)))),128))],2)}function ve(e,t){return t?"string"===typeof t?` ${e}--${t}`:Array.isArray(t)?t.reduce(((t,n)=>t+ve(e,n)),""):Object.keys(t).reduce(((n,o)=>n+(t[o]?ve(e,o):"")),""):""}function xe(e){return(t,n)=>(t&&"string"!==typeof t&&(n=t,t=""),t=t?`${e}__${t}`:e,`${t}${ve(t,n)}`)}function be(e){const t=e;return[t,xe(t)]}const Ce=["src"];function Me(e,t,n,o,l,s){const i=(0,a.up)("Border");return(0,a.wg)(),(0,a.j4)(i,{class:(0,ye.C_)(e.bem()),visibleBox:e.visibleBox,visibleBoxScale:e.visibleBoxScale,style:(0,ye.j5)(e.style),onMousedownScaleXy:t[5]||(t[5]=t=>e.$emit("mousedown-scale-xy")),onMousedownScaleX:t[6]||(t[6]=t=>e.$emit("mousedown-scale-x")),onMousedownScaleY:t[7]||(t[7]=t=>e.$emit("mousedown-scale-y")),onMousedownRotate:t[8]||(t[8]=t=>e.$emit("mousedown-scale-rotate"))},{default:(0,a.w5)((()=>[(0,a._)("div",{class:(0,ye.C_)(e.bem("content")),onMousedown:t[0]||(t[0]=t=>e.$emit("mousedown-content")),onMouseenter:t[1]||(t[1]=t=>e.$emit("mouseenter-content")),onMouseleave:t[2]||(t[2]=t=>e.$emit("mouseleave-content")),onClick:t[3]||(t[3]=t=>e.$emit("click-content")),onDblclick:t[4]||(t[4]=t=>e.$emit("db-click-content"))},[e.imgSrc?((0,a.wg)(),(0,a.iD)("img",{key:0,src:e.imgSrc},null,8,Ce)):(0,a.kq)("",!0)],34)])),_:1},8,["class","visibleBox","visibleBoxScale","style"])}function Se(e,t,n,o,l,s){const i=(0,a.up)("RedoOutlined");return(0,a.wg)(),(0,a.iD)("div",{class:(0,ye.C_)(e.bem({"visible-box":e.visibleBox}))},[(0,a.WI)(e.$slots,"default"),e.visibleBox&&e.visibleBoxScale?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("div",{class:(0,ye.C_)(e.bem("circular","left-top")),onMousedown:t[0]||(t[0]=t=>e.$emit("mousedown-scale-xy"))},null,34),(0,a._)("div",{class:(0,ye.C_)(e.bem("circular","right-top")),onMousedown:t[1]||(t[1]=t=>e.$emit("mousedown-scale-xy"))},null,34),(0,a._)("div",{class:(0,ye.C_)(e.bem("circular","right-bottom")),onMousedown:t[2]||(t[2]=t=>e.$emit("mousedown-scale-xy"))},null,34),(0,a._)("div",{class:(0,ye.C_)(e.bem("circular","left-bottom")),onMousedown:t[3]||(t[3]=t=>e.$emit("mousedown-scale-xy"))},null,34),e.visibleBoxScaleY?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("div",{class:(0,ye.C_)(e.bem("rect","top")),onMousedown:t[4]||(t[4]=t=>e.$emit("mousedown-scale-y"))},null,34),(0,a._)("div",{class:(0,ye.C_)(e.bem("rect","bottom")),onMousedown:t[5]||(t[5]=t=>e.$emit("mousedown-scale-y"))},null,34)],64)):(0,a.kq)("",!0),e.visibleBoxScaleX?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a._)("div",{class:(0,ye.C_)(e.bem("rect","right")),onMousedown:t[6]||(t[6]=t=>e.$emit("mousedown-scale-x"))},null,34),(0,a._)("div",{class:(0,ye.C_)(e.bem("rect","left")),onMousedown:t[7]||(t[7]=t=>e.$emit("mousedown-scale-x"))},null,34)],64)):(0,a.kq)("",!0),(0,a.Wm)(i,{class:(0,ye.C_)(e.bem("rotate")),onMousedown:t[8]||(t[8]=t=>e.$emit("mousedown-rotate"))},null,8,["class"])],64)):(0,a.kq)("",!0)],2)}var Ee=n(2876);const[Xe,ke]=be("border");var Ye=(0,a.aZ)({name:Xe,components:{RedoOutlined:Ee.Z},props:{visibleBox:{type:Boolean,default:!1},visibleBoxScale:{type:Boolean,default:!1},visibleBoxScaleY:{type:Boolean,default:!0},visibleBoxScaleX:{type:Boolean,default:!0}},setup(){return{bem:ke}}});const _e=(0,s.Z)(Ye,[["render",Se]]);var Be=_e;const[$e,Te]=be("image-element");var We=(0,a.aZ)({name:$e,components:{Border:Be},props:{width:{type:Number,default:0},height:{type:Number,default:0},x:{type:Number,default:0},y:{type:Number,default:0},angle:{type:Number,default:0},zIndex:{type:Number,default:null},imgSrc:{type:String,default:""},hover:{type:Boolean,default:!1},focus:{type:Boolean,default:!1},operable:{type:Boolean,default:!0}},setup(e){const t=(0,a.Fl)((()=>e.hover||e.focus)),n=(0,a.Fl)((()=>e.focus&&e.operable)),o=(0,a.Fl)((()=>({width:e.width+"px",height:e.height+"px",transform:`translate(${e.x}px, ${e.y}px) rotateZ(${e.angle}deg)`,zIndex:e.zIndex})));return{visibleBox:t,visibleBoxScale:n,style:o,bem:Te}}});const Fe=(0,s.Z)(We,[["render",Me]]);var He=Fe;function Re(e,t,n,o,l,s){const i=(0,a.up)("ImageElement"),r=(0,a.up)("TextElement"),u=(0,a.up)("GroupElement",!0),d=(0,a.up)("Border");return(0,a.wg)(),(0,a.j4)(d,{class:(0,ye.C_)(e.bem()),visibleBox:e.visibleBox,visibleBoxScale:e.visibleBoxScale,visibleBoxScaleX:!1,visibleBoxScaleY:!1,style:(0,ye.j5)(e.style),onMousedownScaleXy:t[4]||(t[4]=t=>e.$emit("mousedown-scale-xy")),onMousedownRotate:t[5]||(t[5]=t=>e.$emit("mousedown-scale-rotate"))},{default:(0,a.w5)((()=>[(0,a._)("div",{class:(0,ye.C_)(e.bem("content")),onMousedown:t[0]||(t[0]=t=>e.$emit("mousedown-content")),onMouseenter:t[1]||(t[1]=t=>e.$emit("mouseenter-content")),onMouseleave:t[2]||(t[2]=t=>e.$emit("mouseleave-content")),onClick:t[3]||(t[3]=t=>e.$emit("click-content"))},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.children,((e,t)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:t},["image"===e.elementType?((0,a.wg)(),(0,a.j4)(i,(0,ye.vs)((0,a.dG)({key:0},e.state)),null,16)):"text"===e.elementType?((0,a.wg)(),(0,a.j4)(r,(0,ye.vs)((0,a.dG)({key:1},e.state)),null,16)):"group"===e.elementType?((0,a.wg)(),(0,a.j4)(u,(0,ye.vs)((0,a.dG)({key:2},e.state)),null,16)):(0,a.kq)("",!0)],64)))),128))],34)])),_:1},8,["class","visibleBox","visibleBoxScale","style"])}const Ie=["contenteditable"];function ze(e,t,n,o,l,s){const i=(0,a.up)("Border");return(0,a.wg)(),(0,a.j4)(i,{ref:"el",class:(0,ye.C_)(e.bem()),visibleBox:e.visibleBox,visibleBoxScale:e.visibleBoxScale,visibleBoxScaleY:!1,style:(0,ye.j5)(e.style),onMousedownScaleXy:t[5]||(t[5]=t=>e.$emit("mousedown-scale-xy")),onMousedownScaleX:t[6]||(t[6]=t=>e.$emit("mousedown-scale-x")),onMousedownRotate:t[7]||(t[7]=t=>e.$emit("mousedown-scale-rotate"))},{default:(0,a.w5)((()=>[(0,a._)("div",{ref:"contentEl",class:(0,ye.C_)(e.bem("content")),onMousedown:t[1]||(t[1]=t=>e.$emit("mousedown-content")),onMouseenter:t[2]||(t[2]=t=>e.$emit("mouseenter-content")),onMouseleave:t[3]||(t[3]=t=>e.$emit("mouseleave-content")),onClick:t[4]||(t[4]=t=>e.$emit("click-content"))},[(0,a._)("div",{ref:"textEl",class:(0,ye.C_)(e.bem("text",{edit:e.edit})),contenteditable:e.edit,style:(0,ye.j5)(e.textStyle),onInput:t[0]||(t[0]=t=>e.$emit("change-text",t.target.textContent))},(0,ye.zw)(e.text),47,Ie)],34)])),_:1},8,["class","visibleBox","visibleBoxScale","style"])}const[Ne,Pe]=be("text-element");var Ze=(0,a.aZ)({name:Ne,components:{Border:Be},props:{width:{type:Number,default:0},height:{type:Number,default:0},x:{type:Number,default:0},y:{type:Number,default:0},zIndex:{type:Number,default:null},angle:{type:Number,default:0},fontSize:{type:Number,default:null},fontColor:{type:String,default:null},fontFamily:{type:String,default:null},text:{type:String,default:""},edit:{type:Boolean,default:!1},hover:{type:Boolean,default:!1},focus:{type:Boolean,default:!1},operable:{type:Boolean,default:!0}},setup(e,{emit:t}){const n=(0,a.Fl)((()=>e.hover||e.focus)),o=(0,a.Fl)((()=>e.focus&&e.operable)),l=(0,O.iH)(null),s=(0,O.iH)(null),i=(0,O.iH)(null),r=(0,a.Fl)((()=>({width:e.width+"px",height:e.height+"px",transform:`translate(${e.x}px, ${e.y}px) rotateZ(${e.angle}deg)`,zIndex:e.zIndex}))),u=(0,a.Fl)((()=>({fontSize:e.fontSize+"px",fontFamily:e.fontFamily,lineHeight:e.fontSize+"px",color:e.fontColor})));return(0,a.bv)((()=>{t("mounted",{el:l.value,textEl:i.value,contentEl:s.value})})),{visibleBox:n,visibleBoxScale:o,el:l,textEl:i,contentEl:s,style:r,textStyle:u,bem:Pe}}});const je=(0,s.Z)(Ze,[["render",ze]]);var De=je;const[Ue,Ae]=be("group-element");var Le=(0,a.aZ)({name:Ue,components:{Border:Be,ImageElement:He,TextElement:De,GroupElement:qe},props:{width:{type:Number,default:0},height:{type:Number,default:0},x:{type:Number,default:0},y:{type:Number,default:0},zIndex:{type:Number,default:null},angle:{type:Number,default:0},hover:{type:Boolean,default:!1},focus:{type:Boolean,default:!1},operable:{type:Boolean,default:!0},children:{type:Array,default:()=>[]}},setup(e){const t=(0,a.Fl)((()=>e.hover||e.focus)),n=(0,a.Fl)((()=>e.focus&&e.operable)),o=(0,a.Fl)((()=>({width:e.width+"px",height:e.height+"px",transform:`translate(${e.x}px, ${e.y}px) rotateZ(${e.angle}deg)`,zIndex:e.zIndex})));return{visibleBox:t,visibleBoxScale:n,style:o,bem:Ae}}});const Oe=(0,s.Z)(Le,[["render",Re]]);var qe=Oe;const[Ge,Ke]=be("scene");var Je=(0,a.aZ)({name:Ge,components:{ImageElementComponent:He,GroupElementComponent:qe,TextElementComponent:De},props:["elements","handleTextElementMounted","handleMousedownScaleXY","handleMousedownScaleX","handleMousedownScaleY","handleMousedownContent","handleMousedownRotate","handleDbClickContent","handleChangeText","handleClickContent","handleClickTextElementContent","handleMousedown","handleMouseenterContent","handleMouseleaveContent"],setup(){return{bem:Ke}}});const Qe=(0,s.Z)(Je,[["render",we]]);var Ve=Qe;function et(){const e=(0,O.qj)([]),t=(0,O.iH)(null),n=new se;let l,s,i=null,r=null,u=!1,d=null,h=null,c=null,m=null,g=null;function f(t){const n=(0,a.Wm)(Ve,{elements:e,handleTextElementMounted:Y,handleMousedownScaleXY:C,handleMousedownScaleX:M,handleMousedownScaleY:S,handleMousedownContent:E,handleMousedownRotate:X,handleDbClickContent:T,handleChangeText:W,handleClickContent:x,handleClickTextElementContent:b,handleMousedown:k,handleMouseenterContent:B,handleMouseleaveContent:$});(0,o.sY)(n,t),l=new te({width:t.offsetWidth,height:t.offsetHeight,$parent:t}),s=new oe({width:t.offsetWidth,height:t.offsetHeight,$parent:t}),y(t),w(t),v(t)}function p(t){e.push(...t)}function y(n){n.addEventListener("mousedown",(o=>{u=!0,i||(t.value=null);const a={x:o.clientX-n.offsetLeft,y:o.clientY-n.offsetTop};for(let t=0;t<e.length;t++){const n=e[t];if(r&&r!==i&&(r.endEdit(),r=null),n!==i&&(n.blur(),"group"===n.elementType&&n.state.temporary)){for(let t=0;t<n.state.children.length;t++){const o=n.state.children[t];o.setPosition(o.state.x+n.state.x,o.state.y+n.state.y),o.operable(),e.push(o)}e.splice(t,1),t--}}s.ready({originX:a.x,originY:a.y})}))}function w(t){let o=0,a=0;document.addEventListener("mousemove",(i=>{const r={movementX:i.clientX-o,movementY:i.clientY-a,x:i.clientX-t.offsetLeft,y:i.clientY-t.offsetTop,target:i.target};o=i.clientX,a=i.clientY,u&&(h?he(h,r):c?ie(c,r):m?re(m,r):g?me(g,r):d?(d.unHover(),d.blur(),n.handleDragElementTransform({element:d,mouse:r,onTransform(){const{x:t,y:n,xType:o,yType:a}=l.update({originElement:d,targetElements:e});return{x:t,y:n,xType:o,yType:a}}})):s.update({x:r.x,y:r.y,targetElements:e}))}))}function v(o){o.addEventListener("mouseup",(()=>{u=!1,i=null,d=null,h=null,c=null,m=null,g=null,n.clear(),s.clear(),l.clear();const o=s.getCollectElements();if(o&&o.length){const{x:n,y:a,width:l,height:s}=ge(o),i=new pe({x:n,y:a,width:l,height:s,children:o});for(let t=0;t<o.length;t++){const l=o[t];for(let t=0;t<e.length;t++){const o=e[t];o===l&&(o.setPosition(o.state.x-n,o.state.y-a),o.unHover(),o.inoperable(),o.blur(),e.splice(t,1),t--)}}i.temporary(),i.focus(),e.push(i),t.value=i}}))}function x(e){e.focus()}function b(e){e.state.focus&&!e.state.edit?(r=e,e.startEdit(),(0,a.Y3)((()=>{e.target.textEl.focus();const t=document.createRange();t.selectNodeContents(e.target.textEl),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}))):x(e)}function C(e){k(e),h=e}function M(e){k(e),c=e}function S(e){k(e),m=e}function E(e){k(e),d=e}function X(e){k(e),g=e}function k(e){_(e),i=e,t.value=e}function Y(e,t){e.setTarget(t),e.updateSize()}function _(t){for(let n=0;n<e.length;n++)t===e[n]?t.setZIndex(1):e[n].setZIndex(null)}function B(e){e.hover()}function $(e){e.unHover()}async function T(e){const{width:t,height:n,src:o}=await fe();e.setWidth(t),e.setHeight(n),e.setImgSrc(o)}function W(e,t){t.setText(e),t.updateHeight()}return{elements:e,editElement:t,mounted:f,add:p}}var tt={name:"home-view",components:{ImageBar:X,TextBar:W,GroupBar:P,SceneBar:L},setup(){const e=(0,O.iH)(null),t=et();function n(){t.add([new G({imgSrc:"https://st0.dancf.com/static/02/202301290843-d51a.jpg",width:100,height:100,x:0,y:0}),new G({imgSrc:"https://st-gdx.dancf.com/gaodingx/4323/configs/system/20210728-095726-adc9.svg",width:50,height:100,x:100,y:100}),new K({text:"1是文字，，，a￥！%%……￥aaa hello aa的的",width:200,height:100,x:100,y:200})])}function o(e){"image"===e?t.add([new G({imgSrc:"https://st-gdx.dancf.com/gaodingx/4323/configs/system/20210728-095726-adc9.svg",width:100,height:100,x:0,y:0})]):"text"===e&&t.add([new K({text:"输入一段文字",width:200,height:100,x:100,y:200})])}function l(){for(let e=0;e<t.elements.length;e++){const n=t.elements[e];n.blur()}(0,a.Y3)((()=>{Q(e.value)}))}return(0,a.bv)((()=>{t.mounted(e.value),n()})),{parent:e,editElement:t.editElement,handleAddElement:o,handleDownload:l}}};const nt=(0,s.Z)(tt,[["render",v]]);var ot=nt;const at=[{path:"/",name:"home",component:ot}],lt=(0,d.p7)({history:(0,d.r5)(""),routes:at});var st=lt,it=n(65),rt=(0,it.MT)({state:{},getters:{},mutations:{},actions:{},modules:{}});n(2467);(0,o.ri)(u).use(rt).use(st).mount("#app")}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,n),l.exports}n.m=e,function(){var e=[];n.O=function(t,o,a,l){if(!o){var s=1/0;for(d=0;d<e.length;d++){o=e[d][0],a=e[d][1],l=e[d][2];for(var i=!0,r=0;r<o.length;r++)(!1&l||s>=l)&&Object.keys(n.O).every((function(e){return n.O[e](o[r])}))?o.splice(r--,1):(i=!1,l<s&&(s=l));if(i){e.splice(d--,1);var u=a();void 0!==u&&(t=u)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[o,a,l]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var a,l,s=o[0],i=o[1],r=o[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(a in i)n.o(i,a)&&(n.m[a]=i[a]);if(r)var d=r(n)}for(t&&t(o);u<s.length;u++)l=s[u],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(d)},o=self["webpackChunkeditor"]=self["webpackChunkeditor"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(221)}));o=n.O(o)})();
//# sourceMappingURL=app.698383a5.js.map